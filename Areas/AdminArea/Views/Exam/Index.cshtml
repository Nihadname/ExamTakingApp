@model IEnumerable<ExamTakingApp.ViewModels.Exam.ExamListDto>

@{
    ViewData["Title"] = "Exams";
}

<div class="container mt-4">
    <h2 class="mb-3">Exams</h2>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
    }

    <div class="mb-3">
        <a asp-action="Create" class="btn btn-primary">+ Create New Exam</a>
    </div>

    @if (Model.Any())
    {
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Duration (min)</th>
                    <th>Questions</th>
                    <th>Created At</th>
                    <th style="width:250px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var exam in Model)
                {
                    <tr>
                        <td>@exam.Title</td>
                        <td>@exam.Description</td>
                        <td>@exam.DurationMinutes</td>
                        <td>@exam.QuestionCount</td>
                        <td>@exam.CreatedAt?.ToString("yyyy-MM-dd HH:mm")</td>
                        <td>
                            <div class="d-flex gap-1">
                                <a asp-area="AdminArea" asp-controller="Exam" asp-action="Details" asp-route-id="@exam.Id" 
                                   class="btn btn-sm btn-info">Details</a>

                                <a asp-area="AdminArea" asp-controller="Exam" asp-action="Edit" asp-route-id="@exam.Id"
                                   class="btn btn-sm btn-warning">Edit</a>

                                <form id="delete-form-@exam.Id" action="/AdminArea/Exam/Delete/@exam.Id" method="post">
                                    @Html.AntiForgeryToken()
                                    <button type="button" class="btn btn-sm btn-danger" onclick="confirmDelete('@exam.Id')">Delete</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="alert alert-info">No exams available.</div>
    }
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
function confirmDelete(examId) {
    const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
            confirmButton: "btn btn-success",
            cancelButton: "btn btn-danger"
        },
        buttonsStyling: false
    });

    swalWithBootstrapButtons.fire({
        title: "Are you sure?",
        text: "You won't be able to revert this!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Yes, delete it!",
        cancelButtonText: "No, cancel!",
        reverseButtons: true
    }).then((result) => {
        if (result.isConfirmed) {
            const form = document.getElementById('delete-form-' + examId);
            if (form) form.submit();
        } else if (result.dismiss === Swal.DismissReason.cancel) {
            swalWithBootstrapButtons.fire("Cancelled", "Your exam is safe :)", "info");
        }
    });
}
</script>